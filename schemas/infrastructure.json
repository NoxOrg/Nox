{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "The definition namespace for infrastructure components pertaining to a Nox solution.",
  "description": "Define components pertinent to solution infrastructure here. Examples include persistence, messaging, dependencies and endpoints.",
  "type": [
    "object",
    "null"
  ],
  "required": [
    "persistence"
  ],
  "properties": {
    "persistence": {    
      "anyOf": [
        { "$ref": "persistence.json" },
        {
          "additionalProperties": false, 
          "properties": {
            "$ref": {
              "type": "string",
              "format": "uri",
              "pattern": "^[^\\s]*$"
            }
          }
        }
      ]
    },
    "messaging": {    
      "title": "The definition namespace for messaging settings pertaining to a Nox solution.",
      "description": "Defines settings pertinent to solution messaging here. These include IntegrationEventServer provider (RabbitMQ, Azure ServiceBus, Amazon SQS etc) and additional server connection details.",
      "type": [
        "object",
        "null"
      ],
      "required": [
        "integrationEventServer"
      ],
      "properties": {
        "integrationEventServer": {    
          "anyOf": [
            { "$ref": "messagingServer.json" },
            {
              "additionalProperties": false, 
              "properties": {
                "$ref": {
                  "type": "string",
                  "format": "uri",
                  "pattern": "^[^\\s]*$"
                }
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "endpoints": {    
      "title": "The definition namespace for default endpoints pertaining to a Nox solution.",
      "description": "Define default endpoints pertinent to a Nox solution here. These include endpoints for API and BFF servers.",
      "type": [
        "object",
        "null"
      ],
      "properties": {
        "apiServer": {    
          "anyOf": [
            { "$ref": "apiServer.json" },
            {
              "additionalProperties": false, 
              "properties": {
                "$ref": {
                  "type": "string",
                  "format": "uri",
                  "pattern": "^[^\\s]*$"
                }
              }
            }
          ]
        },
        "bffServer": {    
          "anyOf": [
            { "$ref": "bffServer.json" },
            {
              "additionalProperties": false, 
              "properties": {
                "$ref": {
                  "type": "string",
                  "format": "uri",
                  "pattern": "^[^\\s]*$"
                }
              }
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "dependencies": {    
      "anyOf": [
        { "$ref": "dependencies.json" },
        {
          "additionalProperties": false, 
          "properties": {
            "$ref": {
              "type": "string",
              "format": "uri",
              "pattern": "^[^\\s]*$"
            }
          }
        }
      ]
    },
    "security": {    
      "title": "The definition namespace for security settings pertaining to a Nox solution.",
      "description": "Define security settings pertinent to a Nox solution here. These may include secrets among other.",
      "type": [
        "object",
        "null"
      ],
      "properties": {
        "secrets": {    
          "title": "The definition namespace for secrets used in a Nox solution.",
          "description": "Specify properties pertinent to secrets as configured within a Nox solution here. Examples include servers and validity period.",
          "type": [
            "object",
            "null"
          ],
          "properties": {
            "organizationSecretsServer": {    
              "title": "The definition namespace for the secrets server used in a Nox solution.",
              "description": "Specify properties pertinent to the secrets server here. Examples include name, serverUri, Port, connection credentials and provider",
              "type": [
                "object",
                "null"
              ],
              "required": [
                "provider",
                "name",
                "serverUri"
              ],
              "properties": {
                "provider": {    
                  "title": "The secrets server provider.",
                  "description": "The provider used for this secrets server. Examples include AzureKeyVault, AwsKeyManagementService and HashicorpVault.",
                  "type": [
                    "string",
                    "null"
                  ],
                  "enum": [
                    "awsKeyManagementService",
                    "azureKeyVault",
                    "hashicorpVault"
                  ],
                  "additionalProperties": false
                },
                "validFor": {    
                  "title": "The definition namespace for the validity period of secrets as defined in a Nox solution.",
                  "description": "Specify the validity period of secrets pertaining to the solution here. Possible units of measure include days, hours, minutes and seconds.",
                  "type": [
                    "object",
                    "null"
                  ],
                  "properties": {
                    "days": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "hours": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "minutes": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "seconds": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    }
                  },
                  "additionalProperties": false
                },
                "name": {    
                  "title": "The unique name of this server component in the solution.",
                  "description": "The name of this server component in the solution. The name must be unique in the solution configuration",
                  "type": "string",
                  "pattern": "^[^\\s]*$"
                },
                "serverUri": {    
                  "title": "Hostname, IP address or URI.",
                  "description": "The name, address, URI or IP of the server to connect to.",
                  "type": "string"
                },
                "port": {    
                  "title": "Server port",
                  "description": "The port to connect to.",
                  "type": [
                    "integer",
                    "null"
                  ]
                },
                "user": {    
                  "title": "Username.",
                  "description": "The username to use when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "password": {    
                  "title": "Password.",
                  "description": "The password to use when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "options": {    
                  "title": "Additional options.",
                  "description": "A list of additional options to set when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                }
              },
              "additionalProperties": false
            },
            "solutionSecretsServer": {    
              "title": "The definition namespace for the secrets server used in a Nox solution.",
              "description": "Specify properties pertinent to the secrets server here. Examples include name, serverUri, Port, connection credentials and provider",
              "type": [
                "object",
                "null"
              ],
              "required": [
                "provider",
                "name",
                "serverUri"
              ],
              "properties": {
                "provider": {    
                  "title": "The secrets server provider.",
                  "description": "The provider used for this secrets server. Examples include AzureKeyVault, AwsKeyManagementService and HashicorpVault.",
                  "type": [
                    "string",
                    "null"
                  ],
                  "enum": [
                    "awsKeyManagementService",
                    "azureKeyVault",
                    "hashicorpVault"
                  ],
                  "additionalProperties": false
                },
                "validFor": {    
                  "title": "The definition namespace for the validity period of secrets as defined in a Nox solution.",
                  "description": "Specify the validity period of secrets pertaining to the solution here. Possible units of measure include days, hours, minutes and seconds.",
                  "type": [
                    "object",
                    "null"
                  ],
                  "properties": {
                    "days": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "hours": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "minutes": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    },
                    "seconds": {    
                      "type": [
                        "integer",
                        "null"
                      ]
                    }
                  },
                  "additionalProperties": false
                },
                "name": {    
                  "title": "The unique name of this server component in the solution.",
                  "description": "The name of this server component in the solution. The name must be unique in the solution configuration",
                  "type": "string",
                  "pattern": "^[^\\s]*$"
                },
                "serverUri": {    
                  "title": "Hostname, IP address or URI.",
                  "description": "The name, address, URI or IP of the server to connect to.",
                  "type": "string"
                },
                "port": {    
                  "title": "Server port",
                  "description": "The port to connect to.",
                  "type": [
                    "integer",
                    "null"
                  ]
                },
                "user": {    
                  "title": "Username.",
                  "description": "The username to use when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "password": {    
                  "title": "Password.",
                  "description": "The password to use when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "options": {    
                  "title": "Additional options.",
                  "description": "A list of additional options to set when connecting to this server.",
                  "type": [
                    "string",
                    "null"
                  ]
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
